---
pid:            1522
parent:         0
children:       1524
poster:         waldo
title:          Vim25 Crazy Magic
date:           2009-12-11 13:46:52
description:    Interface with vimService on ESXi. 
format:         posh
---

# Vim25 Crazy Magic

### [download](1522.ps1)  [1524](1524.md)

Interface with vimService on ESXi. 

```posh
cls

[void][Reflection.Assembly]::LoadWithPartialName("VMware.Vim");

# generate the proxy
$ws  =  New-WebServiceProxy -Uri "http://172.16.0.33/sdk/vimService?wsdl" ;
$ws.Url = "http://172.16.0.33/sdk/vimService";
$ws.UserAgent = "VMware VI Client/4.0.0";

# I modded the host to accept HTTP requests (too big of a mess with SSL)
# http://www.vmware.com/support/developer/vc-sdk/visdk400pubs/sdk40setupguide.pdf
$vimClient = New-Object Vmware.Vim.VimClient;
$servicecontent  = $vimClient.Connect("http://172.16.0.33/sdk");
$usersession = $vimClient.Login("root","root");

# the below type will be unique to your host.  for some reason the VimApi_25.ManagedObjectReference did not want to pass to the web service
$myMoRef = new-object Microsoft.PowerShell.Commands.NewWebserviceProxy.AutogeneratedTypes.WebServiceProxy172_16_0_33_sdk_vimService_wsdl.ManagedObjectReference;
$myMoRef.type = "HostSystem";
$myMoRef.Value = "ha-host";
# yet to figure out where ha-host comes from... 

# cookie monster your session cookies
$ws.CookieContainer = $vimClient.VimService.CookieContainer;

# call your favorite web service method
$ret = New-Object  Microsoft.PowerShell.Commands.NewWebserviceProxy.AutogeneratedTypes.WebServiceProxy172_16_0_33_sdk_vimService_wsdl.ManagedObjectReference;
$ret = $ws.RebootHost_Task($a,$true);
$ret;
$vimClient.Logout();

exit

# thanks jaykul for your omniscent guidance
```
