---
pid:            3779
parent:         0
children:       3781
poster:         Bryan Jaudon
title:          Exchange AutoReply Admin
date:           2012-11-23 09:54:34
format:         posh
---

# Exchange AutoReply Admin

### [download](3779.ps1) - children: [3781](3781.md)"

Exchange Automatic Replies Administrator - A GUI Front-end to the Get-MailboxAutoReplyConfiguration and Set-MailboxAutoReplyConfiguration cmdlet available in Exchange 2010. This script mimics the GUI available in Outlook. Perfect for Helpdesk or Sysadmins that hate the command-line, but want an easy way to set another users' Automatic Replies (Out of Office) status. Has not been tested with Exchange 2013. Works in PowerShell 2.0 and 3.0. It currently requires the Management Tools be installed on the same computer as the script. 



```posh
<#

    .NOTES
    Name     : Exchange Automatic Replies Administrator.ps1
    Author   : Bryan Jaudon <bryan.jaudon@gmail.com>
    Version  : 1.0
    Date     : 11/23/2012

    .SYNOPSIS
    Provides a graphical front-end to the Get-MailboxAutoReplyConfiguration and
    Set-MailboxAutoReplyConfiguration Exchange cmdlets. Requires Exchange management
    tools be installed on the same system as the script.


#>

#requires -version 2
$Script:ScriptTitle="Exchange Automatic Replies Administrator"

#region Import the Assemblies
[reflection.assembly]::loadwithpartialname("System.Drawing") | Out-Null
[reflection.assembly]::loadwithpartialname("System.Windows.Forms") | Out-Null
[System.Windows.Forms.Application]::EnableVisualStyles()
#endregion

#Generated Form Function
function GenerateForm {
########################################################################
# Code Generated By: SAPIEN Technologies PrimalForms (Community Edition) v1.0.10.0
# Generated On: 11/21/2012 1:56 PM
# Generated By: bjaudon
########################################################################


#region Generated Form Objects
$form1 = New-Object System.Windows.Forms.Form
$labelConnectedFQDN = New-Object System.Windows.Forms.Label
$labelConnected = New-Object System.Windows.Forms.Label
$buttonOK = New-Object System.Windows.Forms.Button
$buttonCancel = New-Object System.Windows.Forms.Button
$labelAutoreply = New-Object System.Windows.Forms.Label
$tabControl1 = New-Object System.Windows.Forms.TabControl
$tabPage1 = New-Object System.Windows.Forms.TabPage
$textInside = New-Object System.Windows.Forms.TextBox
$tabPage2 = New-Object System.Windows.Forms.TabPage
$textOutside = New-Object System.Windows.Forms.TextBox
$dateEndTime = New-Object System.Windows.Forms.DateTimePicker
$dateEndDate = New-Object System.Windows.Forms.DateTimePicker
$labelEndTime = New-Object System.Windows.Forms.Label
$dateStartTime = New-Object System.Windows.Forms.DateTimePicker
$dateStartDate = New-Object System.Windows.Forms.DateTimePicker
$labelStartTime = New-Object System.Windows.Forms.Label
$checkOnlySend = New-Object System.Windows.Forms.CheckBox
$radioSend = New-Object System.Windows.Forms.RadioButton
$radioDoNotSend = New-Object System.Windows.Forms.RadioButton
$comboIdentity = New-Object System.Windows.Forms.ComboBox
$labelIdentity = New-Object System.Windows.Forms.Label
$labelTitle = New-Object System.Windows.Forms.Label
$pbIcon = New-Object System.Windows.Forms.PictureBox
$InitialFormWindowState = New-Object System.Windows.Forms.FormWindowState
#endregion Generated Form Objects

#----------------------------------------------
#Generated Event Script Blocks
#----------------------------------------------
#Provide Custom Code for events specified in PrimalForms.

$dateEndDate_ValueChanged= 
{

    $buttonOK.Enabled=$true    

}

$dateStartTime_ValueChanged= 
{

    $buttonOK.Enabled=$true

}

$textOutside_TextChanged= 
{

    $buttonOK.Enabled=$true

}

$textInside_TextChanged= 
{

    $buttonOK.Enabled=$true

}

$dateStartDate_ValueChanged= 
{

    $buttonOK.Enabled=$true

}

$dateEndTime_ValueChanged= 
{

    $buttonOK.Enabled=$true

}


$buttonOK_OnClick= 
{

    $commandHashTable=@{ "Identity"=$comboIdentity.SelectedItem }

        if ($radioDoNotSend.Checked) { $commandHashTable.Add("AutoReplyState","Disabled") }
        else {
            if ($checkOnlySend.Checked) { 
                $commandHashTable.Add("AutoReplyState","Scheduled") 
                $commandHashTable.Add("StartTime",$(Get-Date -Month $dateStartDate.value.Month -Day $dateStartDate.Value.Day -Year $dateStartDate.value.Year -Hour $dateStartTime.Value.Hour -Minute $dateStartTime.value.Minute -Second $dateStartTime.value.Second))
                $commandHashTable.Add("EndTime",$(Get-Date -Month $dateEndDate.value.Month -Day $dateEndDate.Value.Day -Year $dateEndDate.value.Year -Hour $dateEndTime.Value.Hour -Minute $dateEndTime.value.Minute -Second $dateEndTime.value.Second))
                if ($commandHashTable["EndTime"] -le $commandHashTable["StartTime"]) { ShowPrompt -Message "The end time cannot be less than or equal to start time." -icon Error -Buttons OK;return }
                if ($commandHashTable["EndTime"] -le (Get-Date)) { ShowPrompt -Message "The end time that you entered occurs before the current time." -icon Error -Buttons OK;return }
                }
            else { $commandHashTable.Add("AutoReplyState","Enabled") }

            $commandHashTable.Add("InternalMessage",$textInside.Text)
            $commandHashTable.Add("ExternalMessage",$textOutside.Text)
        }
    
    try { $status=Get-MailboxAutoReplyConfiguration -Identity $comboIdentity.SelectedItem }
    catch { ShowPrompt -Message $_ -Icon Error -Buttons OK;return }

    $result=ShowPrompt -Message "You have chosen to change the Automatic Reply configuration for`n'$($comboIdentity.SelectedItem)' from the state of '$($status.AutoReplyState)' to the state of '$($commandhashtable["AutoReplyState"])'.`n`nDo you wish to commit this change?" -Buttons "YesNo" -icon Warning

    if ($result -eq "Yes") {

        try { Set-MailboxAutoReplyConfiguration @commandHashTable -ErrorAction STOP }
        catch { ShowPrompt -Message $_ -Icon Error -Buttons OK;return }
        
        try { $status=Get-MailboxAutoReplyConfiguration -Identity $comboIdentity.SelectedItem }
        catch { ShowPrompt -Message $_ -Icon Error -Buttons OK;return }
        
        if (($status.AutoReplyState -eq $commandHashTable["AutoReplyState"]) -and ($status.IsValid -eq $True)) {
            ShowPrompt -Message "Automatic Reply configuration successful!" -Icon Information -Buttons OK;GetAutoReplyStatus -identity $comboIdentity.SelectedItem;$buttonOK.Enabled=$false;$form1.Refresh();return
        }
        else { ShowPrompt -Message "Automatic Reply configuration failed. `n`nCurrent Status is: $($status.AutoReplyState)" -Icon Error -Buttons OK;GetAutoReplyStatus -identity $comboIdentity.SelectedItem;$form1.Refresh();return }

    }
    else { ShowPrompt -Message "Automatic Reply configuration cancelled!" -Icon Error -Buttons OK;return }

}

$OnLoadForm_StateCorrection=
{#Correct the initial state of the form to prevent the .Net maximized form issue
    $form1.WindowState = $InitialFormWindowState
    $form1.Update() 
    try { $comboIdentity.items.AddRange($(Get-CASMailbox | sort -Property Identity | Select -ExpandProperty Identity)) }
    catch { ShowPrompt -Message $_ -Buttons OK -Icon Error }

    if ($comboIdentity.items.count -lt 1) { ShowPrompt -Message "There were no Mailboxes found in the Exchange Organization.`nExiting Application." -Buttons OK -Icon Error;$form1.Close() }
}

$comboIdentity_SelectionChangeCommitted=
{
    GetAutoReplyStatus -identity $comboIdentity.SelectedItem
}

$handler_radioSend_Click=
{
    $scheduledstate=$checkOnlySend.Checked
    Status-EnabledAutoReply
    $checkOnlySend.Checked=$scheduledstate
}

$handler_radioDoNotSend_Click=
{
    $scheduledstate=$checkOnlySend.Checked
    Status-DisabledAutoReply
    $checkOnlySend.Checked=$scheduledstate
}

$handler_checkOnlySend_Click=
{
    switch ($checkOnlySend.Checked) {
        true { Status-ScheduledAutoReply }
        false { Status-EnabledAutoReply }
    }
}

#----------------------------------------------
#region Generated Form Code
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 494
$System_Drawing_Size.Width = 538
$form1.ClientSize = $System_Drawing_Size
$form1.DataBindings.DefaultDataSourceUpdateMode = 0
$form1.FormBorderStyle = 1
$form1.MaximizeBox = $False
$form1.MinimizeBox = $False
$form1.Name = "form1"
$form1.ShowIcon = $True
$form1.Text = $script:ScriptTitle
$form1.Icon = $icon

$labelConnectedFQDN.AutoEllipsis = $True
$labelConnectedFQDN.DataBindings.DefaultDataSourceUpdateMode = 0
$labelConnectedFQDN.Font = New-Object System.Drawing.Font("Microsoft Sans Serif",8.25,1,3,0)

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 120
$System_Drawing_Point.Y = 459
$labelConnectedFQDN.Location = $System_Drawing_Point
$labelConnectedFQDN.Name = "labelConnectedFQDN"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 238
$labelConnectedFQDN.Size = $System_Drawing_Size
$labelConnectedFQDN.TabIndex = 18
$labelConnectedFQDN.Text = $connectedFqdn
$labelConnectedFQDN.TextAlign = 16

$form1.Controls.Add($labelConnectedFQDN)

$labelConnected.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 13
$System_Drawing_Point.Y = 459
$labelConnected.Location = $System_Drawing_Point
$labelConnected.Name = "labelConnected"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 101
$labelConnected.Size = $System_Drawing_Size
$labelConnected.TabIndex = 17
$labelConnected.Text = "Connected Server:"
$labelConnected.TextAlign = 16

$form1.Controls.Add($labelConnected)

$buttonOK.DataBindings.DefaultDataSourceUpdateMode = 0
$buttonOK.Enabled = $False

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 370
$System_Drawing_Point.Y = 459
$buttonOK.Location = $System_Drawing_Point
$buttonOK.Name = "buttonOK"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 75
$buttonOK.Size = $System_Drawing_Size
$buttonOK.TabIndex = 16
$buttonOK.Text = "OK"
$buttonOK.UseVisualStyleBackColor = $True
$buttonOK.add_Click($buttonOK_OnClick)

$form1.Controls.Add($buttonOK)

$buttonCancel.DataBindings.DefaultDataSourceUpdateMode = 0
$buttonCancel.DialogResult = 2

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 451
$System_Drawing_Point.Y = 459
$buttonCancel.Location = $System_Drawing_Point
$buttonCancel.Name = "buttonCancel"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 75
$buttonCancel.Size = $System_Drawing_Size
$buttonCancel.TabIndex = 15
$buttonCancel.Text = "Cancel"
$buttonCancel.UseVisualStyleBackColor = $True

$form1.Controls.Add($buttonCancel)

$labelAutoreply.DataBindings.DefaultDataSourceUpdateMode = 0
$labelAutoreply.Enabled = $False

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 13
$System_Drawing_Point.Y = 234
$labelAutoreply.Location = $System_Drawing_Point
$labelAutoreply.Name = "labelAutoreply"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 514
$labelAutoreply.Size = $System_Drawing_Size
$labelAutoreply.TabIndex = 14
$labelAutoreply.Text = "Automatically reply once for each sender with the following messages:"
$labelAutoreply.TextAlign = 16

$form1.Controls.Add($labelAutoreply)

$tabControl1.DataBindings.DefaultDataSourceUpdateMode = 0
$tabControl1.Enabled = $True
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 13
$System_Drawing_Point.Y = 260
$tabControl1.Location = $System_Drawing_Point
$tabControl1.Name = "tabControl1"
$tabControl1.SelectedIndex = 0
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 179
$System_Drawing_Size.Width = 514
$tabControl1.Size = $System_Drawing_Size
$tabControl1.TabIndex = 13

$form1.Controls.Add($tabControl1)
$tabPage1.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 4
$System_Drawing_Point.Y = 22
$tabPage1.Location = $System_Drawing_Point
$tabPage1.Name = "tabPage1"
$System_Windows_Forms_Padding = New-Object System.Windows.Forms.Padding
$System_Windows_Forms_Padding.All = 3
$System_Windows_Forms_Padding.Bottom = 3
$System_Windows_Forms_Padding.Left = 3
$System_Windows_Forms_Padding.Right = 3
$System_Windows_Forms_Padding.Top = 3
$tabPage1.Padding = $System_Windows_Forms_Padding
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 153
$System_Drawing_Size.Width = 506
$tabPage1.Size = $System_Drawing_Size
$tabPage1.TabIndex = 0
$tabPage1.Text = "Inside My Organization"
$tabPage1.UseVisualStyleBackColor = $True

$tabControl1.Controls.Add($tabPage1)
$textInside.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 6
$System_Drawing_Point.Y = 7
$textInside.Location = $System_Drawing_Point
$textInside.Multiline = $True
$textInside.Name = "textInside"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 140
$System_Drawing_Size.Width = 494
$textInside.Size = $System_Drawing_Size
$textInside.TabIndex = 0
$textInside.enabled=$false
$textInside.ScrollBars=3
$textInside.add_TextChanged($textInside_TextChanged)

$tabPage1.Controls.Add($textInside)

$tabPage2.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 4
$System_Drawing_Point.Y = 22
$tabPage2.Location = $System_Drawing_Point
$tabPage2.Name = "tabPage2"
$System_Windows_Forms_Padding = New-Object System.Windows.Forms.Padding
$System_Windows_Forms_Padding.All = 3
$System_Windows_Forms_Padding.Bottom = 3
$System_Windows_Forms_Padding.Left = 3
$System_Windows_Forms_Padding.Right = 3
$System_Windows_Forms_Padding.Top = 3
$tabPage2.Padding = $System_Windows_Forms_Padding
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 153
$System_Drawing_Size.Width = 506
$tabPage2.Size = $System_Drawing_Size
$tabPage2.TabIndex = 1
$tabPage2.Text = "Outside My Organization"
$tabPage2.UseVisualStyleBackColor = $True

$tabControl1.Controls.Add($tabPage2)
$textOutside.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 6
$System_Drawing_Point.Y = 7
$textOutside.Location = $System_Drawing_Point
$textOutside.Multiline = $True
$textOutside.Name = "textOutside"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 140
$System_Drawing_Size.Width = 494
$textOutside.Size = $System_Drawing_Size
$textOutside.TabIndex = 0
$textOutside.enabled=$false
$textOutside.ScrollBars=3
$textOutside.add_TextChanged($textOutside_TextChanged)

$tabPage2.Controls.Add($textOutside)

$dateEndTime.CustomFormat = "h:mm tt"
$dateEndTime.DataBindings.DefaultDataSourceUpdateMode = 0
$dateEndTime.Enabled = $False
$dateEndTime.Format = 8
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 282
$System_Drawing_Point.Y = 204
$dateEndTime.Location = $System_Drawing_Point
$dateEndTime.Name = "dateEndTime"
$dateEndTime.ShowUpDown = $True
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 76
$dateEndTime.Size = $System_Drawing_Size
$dateEndTime.TabIndex = 12
$dateEndTime.add_ValueChanged($dateEndTime_ValueChanged)

$form1.Controls.Add($dateEndTime)

$dateEndDate.CustomFormat = "ddd MM/dd/yyyy"
$dateEndDate.DataBindings.DefaultDataSourceUpdateMode = 0
$dateEndDate.Enabled = $False
$dateEndDate.Format = 8
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 152
$System_Drawing_Point.Y = 204
$dateEndDate.Location = $System_Drawing_Point
$dateEndDate.Name = "dateEndDate"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 124
$dateEndDate.Size = $System_Drawing_Size
$dateEndDate.TabIndex = 11
$dateEndDate.add_ValueChanged($dateEndDate_ValueChanged)

$form1.Controls.Add($dateEndDate)

$labelEndTime.DataBindings.DefaultDataSourceUpdateMode = 0
$labelEndTime.Enabled = $False

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 82
$System_Drawing_Point.Y = 202
$labelEndTime.Location = $System_Drawing_Point
$labelEndTime.Name = "labelEndTime"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 64
$labelEndTime.Size = $System_Drawing_Size
$labelEndTime.TabIndex = 10
$labelEndTime.Text = "End time:"
$labelEndTime.TextAlign = 16

$form1.Controls.Add($labelEndTime)

$dateStartTime.CustomFormat = "h:mm tt"
$dateStartTime.DataBindings.DefaultDataSourceUpdateMode = 0
$dateStartTime.Enabled = $False
$dateStartTime.Format = 8
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 282
$System_Drawing_Point.Y = 178
$dateStartTime.Location = $System_Drawing_Point
$dateStartTime.Name = "dateStartTime"
$dateStartTime.ShowUpDown = $True
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 77
$dateStartTime.Size = $System_Drawing_Size
$dateStartTime.TabIndex = 9
$dateStartTime.add_ValueChanged($dateStartTime_ValueChanged)

$form1.Controls.Add($dateStartTime)

$dateStartDate.CustomFormat = "ddd MM/dd/yyyy"
$dateStartDate.DataBindings.DefaultDataSourceUpdateMode = 0
$dateStartDate.Enabled = $False
$dateStartDate.Format = 8
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 152
$System_Drawing_Point.Y = 178
$dateStartDate.Location = $System_Drawing_Point
$dateStartDate.Name = "dateStartDate"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 124
$dateStartDate.Size = $System_Drawing_Size
$dateStartDate.TabIndex = 8
$dateStartDate.add_ValueChanged($dateStartDate_ValueChanged)

$form1.Controls.Add($dateStartDate)

$labelStartTime.DataBindings.DefaultDataSourceUpdateMode = 0
$labelStartTime.Enabled = $False

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 82
$System_Drawing_Point.Y = 175
$labelStartTime.Location = $System_Drawing_Point
$labelStartTime.Name = "labelStartTime"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 64
$labelStartTime.Size = $System_Drawing_Size
$labelStartTime.TabIndex = 7
$labelStartTime.Text = "Start time:"
$labelStartTime.TextAlign = 16

$form1.Controls.Add($labelStartTime)

$checkOnlySend.DataBindings.DefaultDataSourceUpdateMode = 0
$checkOnlySend.Enabled = $False

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 52
$System_Drawing_Point.Y = 148
$checkOnlySend.Location = $System_Drawing_Point
$checkOnlySend.Name = "checkOnlySend"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 24
$System_Drawing_Size.Width = 190
$checkOnlySend.Size = $System_Drawing_Size
$checkOnlySend.TabIndex = 6
$checkOnlySend.Text = "Only send during this time range:"
$checkOnlySend.UseVisualStyleBackColor = $True
$checkOnlySend.add_Click($handler_checkOnlySend_Click)

$form1.Controls.Add($checkOnlySend)

$radioSend.DataBindings.DefaultDataSourceUpdateMode = 0
$radioSend.Enabled = $False

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 13
$System_Drawing_Point.Y = 125
$radioSend.Location = $System_Drawing_Point
$radioSend.Name = "radioSend"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 24
$System_Drawing_Size.Width = 182
$radioSend.Size = $System_Drawing_Size
$radioSend.TabIndex = 5
$radioSend.Text = "Send automatic replies"
$radioSend.UseVisualStyleBackColor = $True
$radioSend.add_Click($handler_radioSend_Click)

$form1.Controls.Add($radioSend)

$radioDoNotSend.Checked = $True
$radioDoNotSend.DataBindings.DefaultDataSourceUpdateMode = 0
$radioDoNotSend.Enabled = $False

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 13
$System_Drawing_Point.Y = 104
$radioDoNotSend.Location = $System_Drawing_Point
$radioDoNotSend.Name = "radioDoNotSend"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 24
$System_Drawing_Size.Width = 182
$radioDoNotSend.Size = $System_Drawing_Size
$radioDoNotSend.TabIndex = 4
$radioDoNotSend.TabStop = $True
$radioDoNotSend.Text = "Do not send automatic replies"
$radioDoNotSend.UseVisualStyleBackColor = $True
$radioDoNotSend.add_Click($handler_radioDoNotSend_Click)

$form1.Controls.Add($radioDoNotSend)

$comboIdentity.DataBindings.DefaultDataSourceUpdateMode = 0
$comboIdentity.DropDownStyle = 2
$comboIdentity.FormattingEnabled = $True
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 69
$System_Drawing_Point.Y = 67
$comboIdentity.Location = $System_Drawing_Point
$comboIdentity.Name = "comboIdentity"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 21
$System_Drawing_Size.Width = 458
$comboIdentity.Size = $System_Drawing_Size
$comboIdentity.TabIndex = 3
$comboIdentity.add_SelectionChangeCommitted($comboIdentity_SelectionChangeCommitted)

$form1.Controls.Add($comboIdentity)

$labelIdentity.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 13
$System_Drawing_Point.Y = 66
$labelIdentity.Location = $System_Drawing_Point
$labelIdentity.Name = "labelIdentity"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 50
$labelIdentity.Size = $System_Drawing_Size
$labelIdentity.TabIndex = 2
$labelIdentity.Text = "Identity:"
$labelIdentity.TextAlign = 16

$form1.Controls.Add($labelIdentity)

$labelTitle.DataBindings.DefaultDataSourceUpdateMode = 0
$labelTitle.Font = New-Object System.Drawing.Font("Trebuchet MS",9.75,1,3,0)

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 52
$System_Drawing_Point.Y = 13
$labelTitle.Location = $System_Drawing_Point
$labelTitle.Name = "labelTitle"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 31
$System_Drawing_Size.Width = 350
$labelTitle.Size = $System_Drawing_Size
$labelTitle.TabIndex = 1
$labelTitle.Text = $script:ScriptTitle
$labelTitle.TextAlign = 16

$form1.Controls.Add($labelTitle)

$pbIcon.BackgroundImageLayout = 3
$pbIcon.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 13
$System_Drawing_Point.Y = 13
$pbIcon.Location = $System_Drawing_Point
$pbIcon.Name = "pbIcon"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 32
$System_Drawing_Size.Width = 32
$pbIcon.Size = $System_Drawing_Size
$pbIcon.TabIndex = 0
$pbIcon.TabStop = $False
$pbIcon.Image = $logobmp

$form1.Controls.Add($pbIcon)

#endregion Generated Form Code
#Save the initial state of the form
$InitialFormWindowState = $form1.WindowState
#Init the OnLoad event to correct the initial state of the form
$form1.add_Load($OnLoadForm_StateCorrection)
#Show the Form
$form1.ShowDialog()| Out-Null

} #End Function


function GetAutoReplyStatus ($identity) {

    try {
        $status=Get-MailboxAutoReplyConfiguration $identity

            switch ($status.autoreplystate) {

                enabled { Status-EnabledAutoReply }
                disabled { Status-DisabledAutoReply }
                scheduled { Status-ScheduledAutoReply }

            }

            $dateStartDate.Value=$status.StartTime
            $dateStartTime.Value=$status.StartTime
            $dateEndDate.Value=$status.EndTime
            $dateEndTime.Value=$status.EndTime
            $textInside.Text=$status.InternalMessage
            $textOutside.Text=$status.ExternalMessage
            $buttonOK.Enabled=$true
            $form1.Update()
    }
    catch { ShowPrompt -Message $_ -Buttons OK -Icon Error;return }

}

function Status-DisabledAutoReply {

    $radioDoNotSend.enabled=$true
    $radioDoNotSend.checked = $true
    $radioSend.enabled=$true
    $radioSend.Checked=$false
    $checkOnlySend.checked=$false
    $checkOnlySend.enabled=$false
    $labelStartTime.enabled=$false
    $labelEndTime.enabled=$false
    $dateStartDate.enabled=$false
    $dateStartTime.enabled=$false
    $dateEndDate.enabled=$false
    $dateEndTime.enabled=$false
    $labelAutoReply.enabled=$false
    $textInside.enabled=$false
    $textOutside.enabled=$false
    $buttonOK.Enabled=$true
    $form1.Update()
 
}
 
function Status-EnabledAutoReply {

    $radioDoNotSend.enabled=$true
    $radioDoNotSend.checked = $false
    $radioSend.enabled=$true
    $radioSend.Checked=$true
    $checkOnlySend.checked=$false
    $checkOnlySend.enabled=$true
    $labelStartTime.enabled=$false
    $labelEndTime.enabled=$false
    $dateStartDate.enabled=$false
    $dateStartTime.enabled=$false
    $dateEndDate.enabled=$false
    $dateEndTime.enabled=$false
    $labelAutoReply.enabled=$true
    $textInside.enabled=$true
    $textOutside.enabled=$true
    $buttonOK.Enabled=$true
    $form1.Update()
    
}   

function Status-ScheduledAutoReply {

    $radioDoNotSend.enabled=$true
    $radioDoNotSend.checked = $false
    $radioSend.enabled=$true
    $radioSend.Checked=$true
    $checkOnlySend.checked=$true
    $checkOnlySend.enabled=$true
    $labelStartTime.enabled=$true
    $labelEndTime.enabled=$true
    $dateStartDate.enabled=$true
    $dateStartTime.enabled=$true
    $dateEndDate.enabled=$true
    $dateEndTime.enabled=$true
    $labelAutoReply.enabled=$true
    $textInside.enabled=$true
    $textOutside.enabled=$true
    $buttonOK.Enabled=$true
    $form1.Update()
    
}   

Function ShowPrompt {
    param ($Message,$Title=$Script:ScriptTitle,$Buttons,$Icon,$DefaultButton="button1")
    return [System.Windows.Forms.MessageBox]::Show($Message,$Title,$Buttons,$Icon,$DefaultButton)
}

Function Hide-PowerShell {
        $null = $showWindowAsync::ShowWindowAsync((Get-Process -PID $pid).MainWindowHandle, 0)
}

$script:showWindowAsync = Add-Type -MemberDefinition @"
[DllImport("user32.dll")]
public static extern bool ShowWindowAsync(IntPtr hWnd, int nCmdShow);
"@ -name Win32ShowWindowAsync -namespace Win32Functions -PassThru

if ($host.name -ne "Windows PowerShell ISE Host") { Hide-PowerShell } #Only hide console if not run from ISE.

[string]$logob64=@"
iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBI
WXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3AsVFgcLeQdwxQAAAB1pVFh0Q29tbWVudAAAAAAAQ3Jl
YXRlZCB3aXRoIEdJTVBkLmUHAAABsklEQVRYw+2XS0sCURiG31M2OqZol8EobNEiKGjhONEvCNq2
62K1iv5Bi4KsQfoH0Toic9GinS1dBBGl7cKuUF5IJHIodTSH0yKUBMVFHRXy25zNMO/De16+7ztE
0zQ0strQ4NLV+iB1sUV/K2Idd5OmdaAF0AJoAbQAmr8VF4sfnILeNoFc4hzZ55P6O8D1OsrOugPk
EmdlZ92vQI0FoMYC/zCElWb5X+wINQFu4wrd9IaQyRUAAF0mPeQ5EXbBRJg7EI6mqOy7Kon3mA2Q
50UMdPPIPvkpU4Bq4v3WDnzceVFQHthloJL49qIEoVMj6Zs9WkjH2YUwHE3RzcMQ1Pz3mi5YDPC4
JNisPAEA0+gyYbG86gDgOvJGZd9VSRwAkoqKlZ1TAKj54+P1SfKrPrDrD5eJ130ark6PwWLkGteI
7IKJyPMi3TgIQcnkAQA2Kw+PSwoKFoPEEoD8fBs+vrxTtzeI9+xnKYjbC+PBHj4vpe+PqJaOsH0Z
DfWZiXtWhFGvKwVxbf/C+ZrlLs0jS4QTnGwdqNaGi06wuI6K03C430I2ZhwwcO1lTiQV9fKvAb4A
EHe5VK0uOSAAAAAASUVORK5CYII=
"@

$logostream=[System.IO.MemoryStream][System.Convert]::FromBase64String($logob64)
$logobmp=[System.Drawing.Bitmap][System.Drawing.Image]::FromStream($logostream)
$iconhandle=$logobmp.GetHicon()
$icon=[System.Drawing.Icon]::FromHandle($iconhandle)

if (!(Test-Path $env:ExchangeInstallPath\bin\RemoteExchange.ps1)) { ShowPrompt -Message "This application requires the Exchange Management Shell to be installed on this computer. Please install the Exchange Management Tools from the Microsoft Exchange Server installation media." -icon Error -buttons OK;break }
try {
    .$env:ExchangeInstallPath\bin\RemoteExchange.ps1 | Out-Null
    Connect-ExchangeServer -auto | Out-Null
}
catch { ShowPrompt -Message $_ -Buttons OK -Icon Error; break }

GenerateForm
Get-PSSession | Remove-PSSession -Confirm:$false
Exit-PSSession

```
