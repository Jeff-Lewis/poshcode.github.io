---
pid:            3140
parent:         0
children:       3152
poster:         andrewjh
title:          Email-ExpiringADAccounts
date:           2012-01-03 16:36:13
format:         posh
---

# Email-ExpiringADAccounts

### [download](3140.ps1) - children: [3152](3152.md)"

Quick and simple, send an email to AD accounts expiring before a specified date.  The $body is specific to my org needs, but simply customize this to suit.

```posh
Function GetMsgBody {
	Write-Output @"
		<p>Dear $name,</p>
		Your ABC network account is about to expire.<br/>
		Please email helpdesk@abc.com or simply hit 'reply', and include the following details to have your account extended.<br/>
		<br/>
		Your name:<br/>
		The department you currently volunteer in:<br/>
		The staff supervisor's name you currently report to:<br/>
		The current status of your involvement with ABC (Staff/Student/Volunteer):<br/>
		<br/>
		Kind Regards,<br/>
		ABC IT Services
"@
}

Get-QADUser -AccountExpiresBefore "31/01/2012" -Enabled -SizeLimit 0 | ForEach-Object {
	$email = $_.mail
	$name = $_.givenName
	[string]$body = GetMsgBody
	Send-MailMessage -BodyAsHtml:$true -Body $body -To $email -From 'helpdesk@abc.com' -SmtpServer 'smtp.abc.com' -Subject "Your account is about to expire"
	}
```
