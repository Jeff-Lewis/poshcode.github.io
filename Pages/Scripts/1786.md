---
pid:            1786
author:         Daniel
title:          
date:           2010-04-15 11:20:02
format:         posh
parent:         0

---

# 

### [download](Scripts\1786.ps1)



```posh
if (Get-Process 'WRemote' -ea SilentlyContinue) { 
  if (Get-Process 'POS2100' -ea -ErrorAction SilentlyContinue) {
    Write-Host "Restarting WinRemote" 
    Stop-Process -processname WRemote
    Reset-Tray
    #Start-Sleep -Second 2
    #Invoke-Item C:\ICOM\POS2100\WRemote.exe
  }
  else
  {
    Write-Host "WinRemote not running, Starting now..."
    Reset-Tray
    Stop-Process -processname POS2100
    #Invoke-Item C:\ICOM\POS2100\WRemote.exe
}

function Reset-Tray {

   Add-Type -Assembly UIAutomationClient

   $Window = Add-Type -Name ([char[]](65..90 | Get-Random -count 10) -join "") -Member @"
   [DllImport("user32")]
   public static extern IntPtr PostMessage(IntPtr hWnd, UInt32 Msg, Int32 wParam, Int32 lParam);

   public static void SendMouseMove(IntPtr hWnd, ushort x, ushort y) {
      int point = (y << 16) + x;
      PostMessage(hWnd, 0x200, 0, point);
   } 
"@ -Passthru 


   $tray1 = [System.Windows.Automation.AutomationElement]::RootElement.FindAll( "Descendants" , [System.Windows.Automation.Condition]::TrueCondition ) | 
            Where { $_.GetCurrentPropertyValue([System.Windows.Automation.AutomationElement]::ClassNameProperty) -like "SysPager" }
   # On Windows7 and Vista there's this, like, sub-tray thing
   $tray2 = $tray1.FindAll( "Children" , [System.Windows.Automation.Condition]::TrueCondition ) |
            Where { $_.GetCurrentPropertyValue([System.Windows.Automation.AutomationElement]::NameProperty) -eq "User Promoted Notification Area" }
           
   $tray = $(if($tray2) { $tray2 } else { $tray1 })

   $handle = $tray.GetCurrentPropertyValue([System.Windows.Automation.AutomationElement]::NativeWindowHandleProperty)
   $rect = $tray.GetCurrentPropertyValue([System.Windows.Automation.AutomationElement]::BoundingRectangleProperty) 
   $y = $rect.Height/2
   for ( $x = 0; $x -lt $rect.Width; $x += 8) {
      $Window::SendMouseMove( $handle, $x, $y )
   }

}


```
